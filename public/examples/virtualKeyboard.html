<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, interactive-widget=resizes-content">
  <title>VirtualKeyboard ì‹œê°í™” ê°œì„ </title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .keyboard-padding {
      padding-bottom: env(keyboard-inset-height, 0px);
    }
  </style>
</head>
<body class="bg-gray-100 font-mono text-sm">

  <!-- layout viewport (í™”ë©´ ì „ì²´ + ìŠ¤í¬ë¡¤ ì˜ì—­ í¬í•¨) -->
  <div id="layoutBox" class="absolute top-0 left-0 w-full bg-blue-100 border-4 border-blue-500 overflow-auto z-0">

    <!-- visual viewport ì‹œê°í™” -->
    <div id="visualBox" class="absolute border-4 border-red-500 bg-red-100 text-xs text-red-800 p-1 z-10">
      visual viewport
    </div>

    <!-- UI ì¹´ë“œ -->
    <div class="m-4 p-4 space-y-3 bg-white shadow rounded z-20 relative">
      <h1 class="text-xl font-bold">Virtual Keyboard</h1>

      <input id="keyboardInput" class="border w-full mt-2 p-2 rounded" placeholder="í¬ì»¤ìŠ¤í•˜ë©´ í‚¤ë³´ë“œê°€ ì—´ë¦½ë‹ˆë‹¤." />

      <div class="flex flex-wrap gap-2 mt-2">
        <button id="toggleOverlay" class="bg-indigo-600 text-white px-3 py-1 rounded">
          ğŸ”„ overlaysContent í† ê¸€
        </button>
        <button id="togglePadding" class="bg-teal-600 text-white px-3 py-1 rounded">
          ğŸ”§ keyboard-padding í† ê¸€
        </button>
      </div>

      <div class="space-y-1 mt-2">
        <div>ğŸ“ <strong>Layout viewport:</strong> <span id="layoutSize">-</span></div>
        <div>ğŸ“ <strong>Visual viewport:</strong> <span id="visualSize">-</span></div>
        <div>ğŸ” <strong>VirtualKeyboard ìƒíƒœ:</strong> <span id="vkStatus">-</span></div>
        <div>ğŸ“ <strong>keyboard boundingRect.height:</strong> <span id="insetHeight">-</span></div>
      </div>

      <div class="mt-4 border-t pt-2 text-sm text-gray-700 space-y-1">
        <div>ğŸ›  <strong>overlaysContent:</strong> <span id="stateOverlay">-</span></div>
        <div>ğŸ§© <strong>keyboard-padding ì ìš©:</strong> <span id="statePadding">-</span></div>
      </div>
    </div>

    <!-- keyboard-inset-height ì ìš©ëœ í•˜ë‹¨ ê³ ì • UI -->
    <div id="bottomPanel" class="fixed bottom-0 left-0 w-full bg-white shadow z-20 keyboard-padding border-t border-gray-300">
      <div class="p-4 text-center text-sm">
        ğŸ§© fixed bottom-0
      </div>
    </div>
  </div>

  <script>
    const layoutBox = document.getElementById("layoutBox");
    const layoutSize = document.getElementById("layoutSize");
    const visualSize = document.getElementById("visualSize");
    const vkStatus = document.getElementById("vkStatus");
    const insetHeight = document.getElementById("insetHeight");
    const visualBox = document.getElementById("visualBox");
    const keyboardInput = document.getElementById("keyboardInput");
    const toggleOverlay = document.getElementById("toggleOverlay");
    const togglePadding = document.getElementById("togglePadding");
    const bottomPanel = document.getElementById("bottomPanel");
    const stateOverlay = document.getElementById("stateOverlay");
    const statePadding = document.getElementById("statePadding");

    let overlaysState = false;
    let paddingState = true;

    const updateStates = () => {
      stateOverlay.textContent = overlaysState ? 'âœ… ì¼œì§' : 'âŒ êº¼ì§';
      statePadding.textContent = paddingState ? 'âœ… ì ìš©ë¨' : 'âŒ í•´ì œë¨';
    };

    const updateSizes = () => {
      const lw = window.innerWidth;
      const lh = window.innerHeight;
      layoutBox.style.height = `${lh}px`;
      layoutSize.textContent = `${lw}px Ã— ${lh}px`;

      if (window.visualViewport) {
        const vw = window.visualViewport.width;
        const vh = window.visualViewport.height;
        visualSize.textContent = `${vw.toFixed(0)}px Ã— ${vh.toFixed(0)}px`;

        visualBox.style.width = `${vw}px`;
        visualBox.style.height = `${vh}px`;
        visualBox.style.left = `${window.visualViewport.offsetLeft}px`;
        visualBox.style.top = `${window.visualViewport.offsetTop}px`;
      }

      if ("virtualKeyboard" in navigator && navigator.virtualKeyboard.boundingRect) {
        const height = navigator.virtualKeyboard.boundingRect.height;
        insetHeight.textContent = `${height}px`;
      } else {
        insetHeight.textContent = '0px';
      }

      updateStates();
    };

    const updateVkStatus = () => {
      if ("virtualKeyboard" in navigator) {
        overlaysState = navigator.virtualKeyboard.overlaysContent;
        vkStatus.textContent = `ì§€ì›ë¨ (overlaysContent: ${overlaysState ? 'âœ… ì¼œì§' : 'âŒ êº¼ì§'})`;
      } else {
        vkStatus.textContent = "âŒ VirtualKeyboard API ë¯¸ì§€ì›";
      }
      updateStates();
    };

    const init = () => {
      if ("virtualKeyboard" in navigator) {
        navigator.virtualKeyboard.overlaysContent = true;
        overlaysState = true;
        navigator.virtualKeyboard.addEventListener("geometrychange", updateSizes);
      }
      updateSizes();
      updateVkStatus();
    };

    toggleOverlay.addEventListener("click", () => {
      if ("virtualKeyboard" in navigator) {
        overlaysState = !overlaysState;
        navigator.virtualKeyboard.overlaysContent = overlaysState;
        updateVkStatus();
      } else {
        alert("VirtualKeyboard API ë¯¸ì§€ì›");
      }
    });

    togglePadding.addEventListener("click", () => {
      paddingState = !paddingState;
      bottomPanel.classList.toggle("keyboard-padding", paddingState);
      updateStates();
    });

    window.visualViewport?.addEventListener("resize", updateSizes);
    window.addEventListener("resize", updateSizes);
    window.addEventListener("load", init);
  </script>
</body>
</html>